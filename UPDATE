UPDATING THE COMPONENT REGISTRY REST SERVICE AND FLEX UI

Procedure for updating
----------------------

- When upgrading to a new version of the ComponentRegistry, check if there are
  updates to the schema of the PostgreSQL database. These will be named 
  upgrade-x.yy.sql, e.g. upgrade-1.10.sql for version 1.10.

- If the database needs upgrading, first make a backup (dump) of the existing
  database. Stop the application before doing so

- Execute the upgrade script. When upgrading over multiple minor versions, 
  execute the upgrade scripts incrementally

- Make sure to grant all required rights (GRANT ALL unless specified
  otherwise) to the component registry database user (usually compreg) on
  any newly added tables, views, and sequences.

- Then redeploy the WAR and start the application

Version specific update instructions
-------------------------------------

=== 1.14.5 ===

The context parameter eu.clarin.cmdi.componentregistry.isocatRestUrl has been replaced
with the new parameter eu.clarin.cmdi.componentregistry.ccrRestUrl. An example 
configuration with the default value for the new parameter is:


  <Parameter 
  		name="eu.clarin.cmdi.componentregistry.ccrRestUrl" 
  		value="https://openskos.meertens.knaw.nl/ccr/api/"/>

=== 1.14.2 ===

No additional steps required.

=== 1.14.1 ===

No additional steps required.

=== 1.14.0 ===

- Execute DB update script upgrade-1.14.sql

- Add the following context parameter (default values given):

  <Parameter 
	  name="eu.clarin.cmdi.componentregistry.jpaDialect" 
	  value="org.hibernate.dialect.PostgreSQLDialect"/> 

=== 1.13 ===

- The following context fragment have been renamed, and should be updated
  in the context fragment for the Component Registry:
  
  componentRegistryServiceRootUrl -> eu.clarin.cmdi.componentregistry.serviceRootUrl
  componentRegistryAdminUsers -> eu.clarin.cmdi.componentregistry.adminUsers
  
  The results should look something like:
  <Parameter 
  		name="eu.clarin.cmdi.componentregistry.serviceRootUrl" 
  		value="http://catalog.clarin.eu/ds/ComponentRegistry" /> 
  <Parameter 
  		name="eu.clarin.cmdi.componentregistry.adminUsers" 
  		value="admin1@clarin.eu admin2@clarin.eu" />

- The following should be added to the context fragment for the Component
  Registry:

	<Parameter
			name="eu.clarin.cmdi.componentregistry.documentationUrl" 
			value="http://www.clarin.eu/cmdi" /> 
	<Parameter 
			name="eu.clarin.cmdi.componentregistry.generalComponentSchemaUrl" 
			value="https://infra.clarin.eu/cmd/general-component-schema.xsd" /> 
	<Parameter 
			name="eu.clarin.cmdi.componentregistry.component2SchemaXslUrl" 
			value="https://infra.clarin.eu/cmd/xslt/comp2schema-v2/comp2schema.xsl" /> 
	<Parameter 
			name="eu.clarin.cmdi.componentregistry.componentSpecSchemaLocation" 
			value="http://www.clarin.eu/cmd https://infra.clarin.eu/cmd/general-component-schema.xsd" /> 
	<Parameter 
			name="eu.clarin.cmdi.componentregistry.isocatRestUrl" 
			value="https://catalog.clarin.eu/isocat/rest/" /> 
			
=== 1.11 ==

- The following should be added to the context fragment for the Component
  Registry:
    <Parameter
	name="componentRegistryAdminUsers"
	value="space-separated-list-of-admin-eppns"/>

- Added to database schema:
	* comments
	* comments_id_seq
